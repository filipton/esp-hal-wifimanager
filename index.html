<html>

<head>
    <script>
        let device = null;
        let server = null;
        let service = null;
        let characteristic = null;

        async function req() {
            device = await navigator.bluetooth.requestDevice({
                filters: [{
                    services: [0xf254]
                }],
                optionalServices: ['f254a578-ef88-4372-b5f5-5ecf87e65884']
            });

            server = await device.gatt.connect();
            service = await server.getPrimaryService('f254a578-ef88-4372-b5f5-5ecf87e65884');
            characteristic = await service.getCharacteristic('bcd7e573-b0b2-4775-83c0-acbf3aaf210c');

            const value = await characteristic.readValue();
            const decoder = new TextDecoder('utf-8');
            document.getElementById('res').innerText = decoder.decode(value);
            setInterval(async () => {
                document.getElementById('res').innerText = "";
                const value = await characteristic.readValue();
                const decoder = new TextDecoder('utf-8');
                document.getElementById('res').innerText = decoder.decode(value);
            }, 5000);
        }

        async function conn() {
            if (characteristic === null) {
                return;
            }

            let ssid = "";
            let psk = "";

            const encoder = new TextEncoder('utf-8');
            const value = encoder.encode(ssid + '\0' + psk + '\0');
            await characteristic.writeValue(value);
        }
    </script>
</head>

<body>
    <button onclick="req()">REQ</button>

    <h1>RES:</h1>
    <p id="res"></p>

    <button onclick="conn()">CONNECT</button>
</body>

</html>
